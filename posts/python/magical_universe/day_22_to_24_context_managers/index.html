<!doctype html><html lang=en><head><title>Context managers and the `with` statement</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.b0c81e8d5a19b7c855a22c50bdb6f3ed82d31ad8b723e6b49096e34f22acdbbb.css integrity="sha256-sMgejVoZt8hVoixQvbbz7YLTGti3I+a0kJbjTyKs27s="><link rel=icon type=image/png href=/images/author/image_al_hu15845133475761513827.jpg><meta property="og:url" content="https://alpopkes.com/posts/python/magical_universe/day_22_to_24_context_managers/"><meta property="og:site_name" content="Anna-Lena Popkes"><meta property="og:title" content="Context managers and the `with` statement"><meta property="og:description" content="Topics: with statement and context managers Updated 2020-10-05
Context managers and the with statement Similar to decorators, context managers are a concept many people use but only few understand. If you haven’t heard of the term ‘context manager’ before: you probably encountered them already while reading or writing from/to a file using the with statement.
The most common use of context managers is the proper management of resources. In simple terms this means that we want to make sure that we open, read, write and close files correctly."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-14T00:00:00+00:00"><meta property="article:modified_time" content="2018-08-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Context managers and the `with` statement"><meta name=twitter:description content="Topics: with statement and context managers Updated 2020-10-05
Context managers and the with statement Similar to decorators, context managers are a concept many people use but only few understand. If you haven’t heard of the term ‘context manager’ before: you probably encountered them already while reading or writing from/to a file using the with statement.
The most common use of context managers is the proper management of resources. In simple terms this means that we want to make sure that we open, read, write and close files correctly."><meta name=description content="Context managers and the `with` statement"><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/author/image_al_hu15845133475761513827.jpg id=logo alt=Logo>
Anna-Lena Popkes</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#education>Education</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#projects>Projects</a>
<a class=dropdown-item href=/#appearances>Talks & Podcasts</a>
<a class=dropdown-item href=/#recent-posts>Recent Posts</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/author/image_al_hu15845133475761513827.jpg class=d-none id=main-logo alt=Logo>
<img src=/images/author/image_al_hu15845133475761513827.jpg class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/news/ title="Personal news">Personal news</a></li><li><a class=list-link href=/posts/my_path_to_ml/ title="My path to machine learning">My path to machine learning</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/books/> Books</a><ul><li><a class=list-link href=/posts/books/reading_list/ title="Personal reading List">Personal reading List</a></li><li><a class=list-link href=/posts/books/deep_work/ title="Deep work">Deep work</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/machine_learning/> Machine Learning</a><ul><li><a class=list-link href=/posts/machine_learning/bayesian_linear_regression/ title="Bayesian linear regression">Bayesian linear regression</a></li><li><a class=list-link href=/posts/machine_learning/kl_divergence/ title="KL Divergence">KL Divergence</a></li><li><a class=list-link href=/posts/machine_learning/principal_component_analysis/ title="Principal component analysis (PCA)">Principal component analysis (PCA)</a></li><li><a class=list-link href=/posts/machine_learning/support_vector_machines/ title="Support vector machines">Support vector machines</a></li><li><a class=list-link href=/posts/machine_learning/variational_inference/ title="Variational Inference">Variational Inference</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/python/> Python</a><ul class=active><li><a class=list-link href=/posts/python/coding_with_kids/ title="Coding with kids">Coding with kids</a></li><li><a class=list-link href=/posts/python/mocking/ title=Mocking>Mocking</a></li><li><a class=list-link href=/posts/python/packaging_tools/ title="Packaging tools">Packaging tools</a></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/python/magical_universe/> Magical Universe</a><ul class=active><li><a class=list-link href=/posts/python/magical_universe/day_1_start/ title=Start>Start</a></li><li><a class=list-link href=/posts/python/magical_universe/day_1_magical_universe/ title="The Tales of Castle Kilmere">The Tales of Castle Kilmere</a></li><li><a class=list-link href=/posts/python/magical_universe/day_1_first_post_oop/ title="Object-oriented programming">Object-oriented programming</a></li><li><a class=list-link href=/posts/python/magical_universe/day_2_types_of_methods/ title="Types of methods">Types of methods</a></li><li><a class=list-link href=/posts/python/magical_universe/day_3_type_annotations/ title="Type annotations">Type annotations</a></li><li><a class=list-link href=/posts/python/magical_universe/day_4_to_string_conversion/ title="To-string conversion">To-string conversion</a></li><li><a class=list-link href=/posts/python/magical_universe/day_5_decorators/ title=Decorators>Decorators</a></li><li><a class=list-link href=/posts/python/magical_universe/day_6_properties/ title=Properties>Properties</a></li><li><a class=list-link href=/posts/python/magical_universe/day_7_underscore_patterns/ title="Underscore patterns">Underscore patterns</a></li><li><a class=list-link href=/posts/python/magical_universe/day_8_extending_universe/ title="Extending the universe">Extending the universe</a></li><li><a class=list-link href=/posts/python/magical_universe/day_9_duck_typing/ title="Duck Typing">Duck Typing</a></li><li><a class=list-link href=/posts/python/magical_universe/day_10_11_namedtuples/ title=Namedtuples>Namedtuples</a></li><li><a class=list-link href=/posts/python/magical_universe/day_12_to_15_abcs/ title="Abstract Base Classes">Abstract Base Classes</a></li><li><a class=list-link href=/posts/python/magical_universe/day_16_to_18_data_classes/ title="Data classes">Data classes</a></li><li><a class=list-link href=/posts/python/magical_universe/day_19_immutable_data_classes/ title="Immutable data classes">Immutable data classes</a></li><li><a class=list-link href=/posts/python/magical_universe/day_20_decorators_in_classes/ title="Decorators in classes">Decorators in classes</a></li><li><a class=list-link href=/posts/python/magical_universe/day_21_if_main/ title='if __name__ == "__main__"'>if __name__ == "__main__"</a></li><li><a class="active list-link" href=/posts/python/magical_universe/day_22_to_24_context_managers/ title="Context managers">Context managers</a></li><li><a class=list-link href=/posts/python/magical_universe/day_25_to_28_pytest/ title="Testing with pytest">Testing with pytest</a></li><li><a class=list-link href=/posts/python/magical_universe/day_29_to_31_iterators/ title=Iterators>Iterators</a></li><li><a class=list-link href=/posts/python/magical_universe/day_34_multisets/ title=Multisets>Multisets</a></li><li><a class=list-link href=/posts/python/magical_universe/day_37_extending_universe/ title="Extending the universe II">Extending the universe II</a></li><li><a class=list-link href=/posts/python/magical_universe/day_43_to_45_exception_classes/ title="Exception classes">Exception classes</a></li><li><a class=list-link href=/posts/python/magical_universe/day_46_functools_wraps/ title=functools.wraps>functools.wraps</a></li><li><a class=list-link href=/posts/python/magical_universe/day_47_to_48_defaultdict/ title=Defaultdict>Defaultdict</a></li><li><a class=list-link href=/posts/python/magical_universe/day_49_to_50_config_files/ title="Config files">Config files</a></li><li><a class=list-link href=/posts/python/magical_universe/2018-09-16-blog-post-day-51/ title="Wrap up">Wrap up</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/software_engineering/> Software Engineering</a><ul><li><a class=list-link href=/posts/software_engineering/containers/ title="Intro to containers">Intro to containers</a></li><li><a class=list-link href=/posts/software_engineering/docker/ title="Intro to Docker">Intro to Docker</a></li><li><a class=list-link href=/posts/software_engineering/virtual_machines/ title="Intro to virtual machines">Intro to virtual machines</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/image_al_hu6187147171234605626.jpg alt="Author Image"><h5 class=author-name>Anna-Lena Popkes</h5><p class=text-muted>Tuesday, August 14, 2018</p></div><div class=title><h1>Context managers and the `with` statement</h1></div><div class=post-content id=post-content><p><strong>Topics:</strong> <code>with</code> statement and context managers<br><strong>Updated</strong> 2020-10-05</p><h2 id=context-managers-and-the-with-statement>Context managers and the <code>with</code> statement</h2><p>Similar to decorators, context managers are a concept many people use but only few understand. If you haven&rsquo;t heard of the term &lsquo;context manager&rsquo; before: you probably encountered them already while reading or writing from/to a file using the <code>with</code> statement.</p><p>The most common use of context managers is the proper <em>management of resources</em>. In simple terms this means that we want to make sure that we open, read, write and close files correctly. Before creating our own context manager, let&rsquo;s take a look at the most common use of the <code>with</code> statement and why the <code>with</code> statement is so useful.</p><h2 id=using-with-to-open-files>Using <code>with</code> to open files</h2><p>In the world of Castle Kilmere a lot of communication is done via good old letters. So let&rsquo;s imagine that Lissy wants to write a letter to Bromley asking if she and Luke can stop by for tea in the afternoon. To do so, we open a file called &rsquo;letter.txt&rsquo; and write a few lines of text to the file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;letter.txt&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> letter:
</span></span><span style=display:flex><span>    letter<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Hi Bromley! </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Can Luke and I stop by for a tea this afternoon? </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Lissy&#34;</span>)
</span></span></code></pre></div><p>Internally, this is translated to something like this (details of the full translation can be found <a href=https://www.python.org/dev/peps/pep-0343/#specification-the-with-statement target=_blank rel=noopener>in PEP 343</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>letter<span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#39;letter.txt&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    letter<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Hi Bromley! </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Can Luke and I stop by for a tea this afternoon? </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Lissy&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>    letter<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>The <code>try ... finally</code> statement is the key part: it guarantees that the code in the <code>finally</code> block is <strong>always executed</strong> no matter what happens in the <code>try</code> block.</p><h2 id=why-the-with-statement-is-useful>Why the <code>with</code> statement is useful</h2><p>In the <code>with</code> statement above, the <code>open</code> keyword opens a file descriptor. As you probably know it&rsquo;s very important that every time you open a file, you also need to close it. Otherwise, when opening too many files, your operating system will throw an error at some point.</p><p>By using the <code>with</code> statement we ensure that the open file descriptor is <em>closed automatically</em> after the control flow leaves the context of the <code>with</code> statement. So even when an exception occurs before the end of the <code>with</code> block, the opened file will be closed. Also when using a <code>return</code>, <code>continue</code> or <code>break</code> statement in the <code>with</code> block, the file will be closed automatically. We don&rsquo;t have to write <code>try ... except ... finally</code> blocks ourselves - the <code>with</code> statement takes care of properly closing the file. This makes sure that we are not <em>leaking any resources</em>, i.e. forget to close opened files.</p><p>So in short: the <code>with</code> statement<br>a) Makes code that deals with resources more readable<br>b) Ensures that resources are not leaked</p><p>If you want to see an example of how context managers are used within Python, take a look at the <code>threading.Lock</code> class. It can be found <a href=https://docs.python.org/3/library/threading.html#lock-objects target=_blank rel=noopener>here</a>.</p><h2 id=creating-our-own-context-manager>Creating our own context manager</h2><p>Let&rsquo;s say we want to create a <code>Letter</code> class in our Magical Universe that functions as a context manager. This would allows us to create a function called <code>write_letter()</code> that opens a letter object and writes text to it. So in the end we want to be able to use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> Letter(<span style=color:#e6db74>&#39;lettername.txt&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> letter:
</span></span><span style=display:flex><span>    letter<span style=color:#f92672>.</span>write(<span style=color:#f92672>...</span>)
</span></span></code></pre></div><p>To achieve this functionality, our <code>Letter</code> class needs to contain two methods: <code>__enter__()</code> and <code>__exit__()</code>. When these methods are implemented, our class follows the context manager protocol and supports the <code>with</code> statement. More about context managers can be found in the <a href=https://docs.python.org/3/library/stdtypes.html#typecontextmanager target=_blank rel=noopener>Python docs</a>.</p><h2 id=letter-class><code>Letter</code> class</h2><p>Creating a context manager is not difficult. Our <code>Letter</code> class will look as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Letter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, letter_name: str):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>letter_name <span style=color:#f92672>=</span> letter_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __enter__(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>letter <span style=color:#f92672>=</span> open(self<span style=color:#f92672>.</span>letter_name, <span style=color:#e6db74>&#39;w&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>letter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __exit__(self, exc_type, exc_value, traceback):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>letter:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>letter<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>That&rsquo;s it! With a proper implemetation of <code>__enter__()</code> and <code>__exit__()</code> our <code>Letter</code> class supports the <code>with</code> statement:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> Letter(<span style=color:#e6db74>&#39;dear_bromley.txt&#39;</span>) <span style=color:#66d9ef>as</span> letter:
</span></span><span style=display:flex><span>    letter<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Hi Bromley! </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Can Luke and I stop by for a tea this afternoon? </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#e6db74>&#34;Lissy&#34;</span>)
</span></span></code></pre></div><h2 id=steps-of-the-with-statement>Steps of the with statement</h2><p>You might wonder when exactly <code>__enter__()</code> and <code>__exit__()</code> are called and what happens behind the scences when using the <code>with</code> statement. Therefore, we will take a closer look at the individual steps.</p><p>To be more precise: when the <code>with</code> statement is executed with a single file like &rsquo;letter.txt&rsquo;:</p><ol><li>The <code>with</code> statement invokes a context manager.</li><li>The context manager&rsquo;s <code>__exit__()</code> method is loaded for later use.</li><li>The context manager&rsquo;s <code>__enter__()</code> method is invoked.</li><li>The value returned by the <code>__enter__()</code> method is bound to the identifier in the <code>as</code> clause of the <code>with</code> statement (i.e. the return value of <code>__enter__()</code> is bound to the variable &rsquo;letter&rsquo;).</li><li>The code in the body of the <code>with</code> statement is executed (i.e. the <code>letter.write(...)</code> part).</li><li>The context manager&rsquo;s <code>__exit__()</code> method is invoked <strong>no matter what happened in the code body</strong>.</li></ol><p>If an exception occured in the code body, its type, value and traceback are passed as arguments to <code>__exit__()</code>. So we can use <code>__exit__()</code> to handle those exceptions, for example, we could suppress them.</p><p>For further details on these steps, take a look at the <a href=https://docs.python.org/3/reference/compound_stmts.html#with target=_blank rel=noopener>Python docs</a>.</p><h2 id=writing-letters>Writing letters</h2><p>Currently, our <code>Letter</code> class is very simple and not doing more than the <code>open()</code> statement. However, <code>Letter</code> is a regular class, so we could extend it with all kinds of methods. As long as <code>__enter__()</code> and <code>__exit__()</code> are implemented properly, the class will support the <code>with</code> statement. For example, we could keep track of how many letters have been created so far:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Letter</span>:
</span></span><span style=display:flex><span>    total_number_of_letters <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, letter_name: str):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>letter_name <span style=color:#f92672>=</span> letter_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __enter__(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>letter <span style=color:#f92672>=</span> open(self<span style=color:#f92672>.</span>letter_name, <span style=color:#e6db74>&#39;w&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>total_number_of_letters <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>letter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __exit__(self, exc_type, exc_value, traceback):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>letter:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>letter<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>As a last step, we will add a <code>write_letter()</code> method to our <code>CastleKilmereMember</code> class. This will allow all Castle Kilmere members to write actual letters (even if we can&rsquo;t send them by owl).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CastleKilmereMember</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34; Creates a member of the Castle Kilmere School of Magic &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_letter</span>(self, recipient: str, content: str):
</span></span><span style=display:flex><span>        letter_name <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;letter_nr_</span><span style=color:#e6db74>{</span>Letter<span style=color:#f92672>.</span>total_number_of_letters<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;_from_</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>_to_</span><span style=color:#e6db74>{</span>recipient<span style=color:#e6db74>}</span><span style=color:#e6db74>.txt&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> Letter(letter_name) <span style=color:#66d9ef>as</span> l:
</span></span><span style=display:flex><span>            l<span style=color:#f92672>.</span>write(content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    lissy <span style=color:#f92672>=</span> Pupil<span style=color:#f92672>.</span>lissy()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    letter_content <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hi Bromley! </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Can Luke and I stop by for a tea this afternoon? </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Lissy&#34;</span>
</span></span><span style=display:flex><span>    lissy<span style=color:#f92672>.</span>write_letter(<span style=color:#e6db74>&#39;Bromley&#39;</span>, letter_content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Total number of letter creates so far: </span><span style=color:#e6db74>{</span>Letter<span style=color:#f92672>.</span>total_number_of_letters<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h2 id=contextlibcontextmanager>Contextlib.contextmanager</h2><p>Context managers don&rsquo;t have to be class-based. We could also use the <a href=https://docs.python.org/3/library/contextlib.html target=_blank rel=noopener>contextlib module</a> to support the with statement.</p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/zotroneneis/zotroneneis.github.io/edit/main/content/posts/python/magical_universe/day_22_to_24_context_managers.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/python/magical_universe/day_21_if_main/ title='The mysterious `if __name__ == "__main__"`' class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>The mysterious `if __name__ == "__main__"`</div></a></div><div class="col-md-6 next-article"><a href=/posts/python/magical_universe/day_25_to_28_pytest/ title="Testing code with pytest" class="btn filled-button"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Testing code with pytest</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#context-managers-and-the-with-statement>Context managers and the <code>with</code> statement</a></li><li><a href=#using-with-to-open-files>Using <code>with</code> to open files</a></li><li><a href=#why-the-with-statement-is-useful>Why the <code>with</code> statement is useful</a></li><li><a href=#creating-our-own-context-manager>Creating our own context manager</a></li><li><a href=#letter-class><code>Letter</code> class</a></li><li><a href=#steps-of-the-with-statement>Steps of the with statement</a></li><li><a href=#writing-letters>Writing letters</a></li><li><a href=#contextlibcontextmanager>Contextlib.contextmanager</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://alpopkes.com/#appearances>Talks & Podcasts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:popkes@gmx.net target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>popkes@gmx.net</span></a></li><li><a href=https://github.com/zotroneneis target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>zotroneneis</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu16779671404603505019.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020-2021 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.d7aab8398181e71632b7543a04f74db83c8a6210962005e5d34884b8613a8404.js integrity="sha256-16q4OYGB5xYyt1Q6BPdNuDyKYhCWIAXl00iEuGE6hAQ=" defer></script></body></html>