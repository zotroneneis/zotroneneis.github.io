<!doctype html><html><head><title>collections.defaultdict</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/author/image_al_hu6aa485cfd64a98f54b411e3a0324b396_178285_42x0_resize_q75_box.jpg><link rel=stylesheet href=/css/style.css><meta name=description content="collections.defaultdict"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/><img src=/images/author/image_al_hu6aa485cfd64a98f54b411e3a0324b396_178285_42x0_resize_q75_box.jpg>Anna-Lena Popkes</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/author/image_al_hu6aa485cfd64a98f54b411e3a0324b396_178285_42x0_resize_q75_box.jpg class=d-none id=main-logo>
<img src=/images/author/image_al_hu6aa485cfd64a98f54b411e3a0324b396_178285_42x0_resize_q75_box.jpg class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/news/>Personal news</a></li><li><a href=/posts/my_path_to_ml/>My path to machine learning</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/books/>Books</a><ul><li><a href=/posts/books/reading_list/>Personal reading List</a></li><li><a href=/posts/books/deep_work/>Deep work</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/machine_learning/>Machine Learning</a><ul><li><a href=/posts/machine_learning/bayesian_linear_regression/>Bayesian linear regression</a></li><li><a href=/posts/machine_learning/bayesian_linear_regression_2/>Bayesian linear regression 2</a></li><li><a href=/posts/machine_learning/kl_divergence/>KL Divergence</a></li><li><a href=/posts/machine_learning/principal_component_analysis/>Principal component analysis (PCA)</a></li><li><a href=/posts/machine_learning/support_vector_machines/>Support vector machines</a></li><li><a href=/posts/machine_learning/variational_inference/>Variational Inference</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/python/>Python</a><ul class=active><li><a href=/posts/python/mocking/>Mocking</a></li><li><a href=/posts/python/packaging_tools/>Packaging tools</a></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/python/magical_universe/>Magical Universe</a><ul class=active><li><a href=/posts/python/magical_universe/day_1_start/>Start</a></li><li><a href=/posts/python/magical_universe/day_1_magical_universe/>The Tales of Castle Kilmere</a></li><li><a href=/posts/python/magical_universe/day_1_first_post_oop/>Object-oriented programming</a></li><li><a href=/posts/python/magical_universe/day_2_types_of_methods/>Types of methods</a></li><li><a href=/posts/python/magical_universe/day_3_type_annotations/>Type annotations</a></li><li><a href=/posts/python/magical_universe/day_4_to_string_conversion/>To-string conversion</a></li><li><a href=/posts/python/magical_universe/day_5_decorators/>Decorators</a></li><li><a href=/posts/python/magical_universe/day_6_properties/>Properties</a></li><li><a href=/posts/python/magical_universe/day_7_underscore_patterns/>Underscore patterns</a></li><li><a href=/posts/python/magical_universe/day_8_extending_universe/>Extending the universe</a></li><li><a href=/posts/python/magical_universe/day_9_duck_typing/>Duck Typing</a></li><li><a href=/posts/python/magical_universe/day_10_11_namedtuples/>Namedtuples</a></li><li><a href=/posts/python/magical_universe/day_12_to_15_abcs/>Abstract Base Classes</a></li><li><a href=/posts/python/magical_universe/day_16_to_18_data_classes/>Data classes</a></li><li><a href=/posts/python/magical_universe/day_19_immutable_data_classes/>Immutable data classes</a></li><li><a href=/posts/python/magical_universe/day_20_decorators_in_classes/>Decorators in classes</a></li><li><a href=/posts/python/magical_universe/day_21_if_main/>if __name__ == "__main__"</a></li><li><a href=/posts/python/magical_universe/day_22_to_24_context_managers/>Context managers</a></li><li><a href=/posts/python/magical_universe/day_25_to_28_pytest/>Testing with pytest</a></li><li><a href=/posts/python/magical_universe/day_29_to_31_iterators/>Iterators</a></li><li><a href=/posts/python/magical_universe/day_34_multisets/>Multisets</a></li><li><a href=/posts/python/magical_universe/day_37_extending_universe/>Extending the universe II</a></li><li><a href=/posts/python/magical_universe/day_43_to_45_exception_classes/>Exception classes</a></li><li><a href=/posts/python/magical_universe/day_46_functools_wraps/>functools.wraps</a></li><li><a class=active href=/posts/python/magical_universe/day_47_to_48_defaultdict/>Defaultdict</a></li><li><a href=/posts/python/magical_universe/day_49_to_50_config_files/>Config files</a></li><li><a href=/posts/python/magical_universe/2018-09-16-blog-post-day-51/>Wrap up</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/software_engineering/>Software Engineering</a><ul><li><a href=/posts/software_engineering/containers/>Intro to containers</a></li><li><a href=/posts/software_engineering/docker/>Intro to Docker</a></li><li><a href=/posts/software_engineering/virtual_machines/>Intro to virtual machines</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://alpopkes.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/image_al.jpg><h5 class=author-name>Anna-Lena Popkes</h5><p>September 7, 2018</p></div><div class=title><h1>collections.defaultdict</h1></div><div class=post-content id=post-content><p><strong>Topics:</strong> <code>collections.defaultdict</code><br><strong>Updated</strong> 2020-10-06</p><h2 id=the-collections-module>The <code>collections</code> module</h2><p>The <a href=https://docs.python.org/3/library/collections.html#module-collections><code>collections</code> module</a> in Python contains several useful classes. One of them is especially helpful for our Magical Universe: <code>collections.defaultdict</code>.</p><p>When defining our <code>CastleKilmereMember</code> class we specified <code>self.traits</code> to be an empty dictionary. New positive and negative traits can be added to a person using the <code>add_trait()</code> function. We can check whether a person possesses a certain trait using the <code>exhibits_trait()</code> function. The relevant parts of the class look as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CastleKilmereMember</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34; Creates a member of the Castle Kilmere School of Magic &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, name: str, birthyear: int, sex: str):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>birthyear <span style=color:#f92672>=</span> birthyear
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sex <span style=color:#f92672>=</span> sex
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_traits <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_trait</span>(self, trait, value<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_traits[trait] <span style=color:#f92672>=</span> value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exhibits_trait</span>(self, trait: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_traits[trait]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> value
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyError</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>_name<span style=color:#e6db74>}</span><span style=color:#e6db74> does not have a character trait with the name </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span></code></pre></div><p>As visible in the definition of <code>exhibits_trait()</code> we have to catch and handle errors caused by querying the <code>_traits</code> dictionary with a non-existent key. Wouldn&rsquo;t it be much nicer if we could just return <code>False</code> in case a Castle Kilmere member does not possess a certain character trait? We already discussed that this can be achieved using the <code>dict.get()</code> function (see post on Duck Typing for more details). Another, even more powerful solution is to use the <code>defaultdict</code> class from the <code>collections</code> module.</p><h2 id=collectionsdefaultdict><code>collections.defaultdict</code></h2><p><code>collections.defaultdict</code> is a subclass of the general dictionary type. What makes <code>defaultdict</code> perfect for our problem is that it allows to specify a <em>callable</em> whose return value will be used whenever a requested key cannot found. The basic usage of <code>collections.defaultdict</code> is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dict_ <span style=color:#f92672>=</span> defaultdict(default_factory)
</span></span></code></pre></div><p>if <code>default_factory</code> is not specified, i.e. if we just use <code>dict_ = defaultdict()</code> the dictionary will raise a <code>KeyError</code> whenever a requested key cannot be found (just like a normal dictionary). So we want to specify a default value.</p><p>Although we want to use <code>False</code> as our default value, we can&rsquo;t use <code>dict_ = defaultdict(False)</code>. The reason for this is simple: <code>defaultdict</code> requires a callable (e.g. a function) as an argument that provides the default value when invoked without arguments. <code>False</code> is not a callable but a boolean. So we have to define a function that returns <code>False</code> when called without arguments:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>return_false</span>() <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dict_ <span style=color:#f92672>=</span> defaultdict(return_false)
</span></span></code></pre></div><p>Alternatively, we could also specify a lambda function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>dict_ <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: <span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><p>The fact that <code>defaultdict</code> requires a callable makes it very powerful. We could create any kind of function and use the functions return value as a default. This has several important use cases. One common problem that can be solved with a defaultdict is grouping items in a collection.</p><h2 id=grouping-items-in-a-collection>Grouping items in a collection</h2><p>Lets say we have a list of some of the pets Castle Kilmeres pupils are allowed to bring to school. We want to group the pets by type, that is, having all the owls together, all the cats and so on.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pets <span style=color:#f92672>=</span> [(<span style=color:#e6db74>&#39;Cotton&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Ramses&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Twiggles&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Oscar&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Louie&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>), (<span style=color:#e6db74>&#39;Bob&#39;</span>, <span style=color:#e6db74>&#39;ferret&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Winston&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Harry&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>)]
</span></span></code></pre></div><p>This can be achieved by providing the callable <code>list</code> as an argument to the defaultdict. We create a defaultdict using <code>list</code> as a default factory. To group the pets, we loop through our list of pets. Our first item in the list is <code>Cotton</code> (Luke&rsquo;s owl). When we try to find the key <code>owl</code> in the dictionary it won&rsquo;t be found. Since we used <code>list</code> as a default factory, a new empty list will be created and inserted into the dictionary for the key <code>owl</code>. We then append the name (which is <code>Cotton</code>) to this list. The next time we look for the key <code>owl</code> it will already be contained in the dictionary and the name can be appended to the existing list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pets <span style=color:#f92672>=</span> [(<span style=color:#e6db74>&#39;Cotton&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Ramses&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Twiggles&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Oscar&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Louie&#39;</span>, <span style=color:#e6db74>&#39;cat&#39;</span>), (<span style=color:#e6db74>&#39;Bob&#39;</span>, <span style=color:#e6db74>&#39;ferret&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;Winston&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>), (<span style=color:#e6db74>&#39;Harry&#39;</span>, <span style=color:#e6db74>&#39;owl&#39;</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>types_of_pets <span style=color:#f92672>=</span> defaultdict(list)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> name, type_ <span style=color:#f92672>in</span> pets:
</span></span><span style=display:flex><span>    types_of_pets[type_]<span style=color:#f92672>.</span>append(name)
</span></span></code></pre></div><p>Take a guess how the output looks like when looping through the resulting dictionary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> key, value <span style=color:#f92672>in</span> types_of_pets<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>key<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>value<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p>The output is hopefully what you expected. We get a list of all owls, a list of all cats, and so on:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> key, value <span style=color:#f92672>in</span> types_of_pets<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>key<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>value<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> owl: [<span style=color:#e6db74>&#39;Cotton&#39;</span>, <span style=color:#e6db74>&#39;Twiggles&#39;</span>, <span style=color:#e6db74>&#39;Winston&#39;</span>, <span style=color:#e6db74>&#39;Harry&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> cat: [<span style=color:#e6db74>&#39;Ramses&#39;</span>, <span style=color:#e6db74>&#39;Oscar&#39;</span>, <span style=color:#e6db74>&#39;Louie&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> ferret: [<span style=color:#e6db74>&#39;Bob&#39;</span>]
</span></span></code></pre></div><p>There are a lot more uses cases for the <code>defaultdict</code> class. For example, we could use a <code>defaultdict</code> to count the number of pets of each type. Use this as an exercise: which <code>default_factory</code> could we use to count the number of pets of each type?</p></div><div class=btn-improve-page><a href=https://github.com/zotroneneis/zotroneneis.github.io/edit/main/content/posts/python/magical_universe/day_47_to_48_defaultdict.md><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/python/magical_universe/day_49_to_50_config_files/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i> Prev</span><br><span>Config files</span></a></div><div class="col-md-6 next-article"><a href=/posts/python/magical_universe/day_46_functools_wraps/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>functools.wraps - avoiding losing metdata when applying decorators</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#the-collections-module>The <code>collections</code> module</a></li><li><a href=#collectionsdefaultdict><code>collections.defaultdict</code></a></li><li><a href=#grouping-items-in-a-collection>Grouping items in a collection</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#appearances>Talks & Podcasts</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email: </span><span>popkes@gmx.net</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png>
Toha</a></div><div class="col-md-4 text-center">© 2020-2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/js/jquery-3.4.1.min.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/navbar.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>